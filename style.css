* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: #fff;
  min-height: 100vh;
  display: grid;
  place-items: center;

  background-image: url("img/back.jpg");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at center,
              rgba(0,0,0,0.35) 0%,
              rgba(0,0,0,0.65) 70%,
              rgba(0,0,0,0.85) 100%);
  z-index: 0;
}

/* –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ–≤–µ—Ä—Ö */
.wrap { width: min(900px, 92vw); text-align: center; position: relative; z-index: 20; }
.title { margin: 0 0 14px; font-weight: 800; letter-spacing: .2px; }

.stage {
  width: min(520px, 90vw);
  margin: 0 auto;
  padding: 18px;
  border-radius: 18px;

  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  backdrop-filter: blur(6px);

  display: flex;
  justify-content: center;
  align-items: center;

  position: relative;
  overflow: hidden;

  transition: background .6s ease, border-color .6s ease;
}

.stage.stage--final {
  background: #ffffff;
  border-color: rgba(255,255,255,0.55);
  backdrop-filter: none;
}

.heart {
  width: 100%;
  height: auto;
  max-width: 480px;

  position: relative;
  z-index: 1;
  opacity: 1;
  transform: none;
  transition: opacity .9s ease, transform .9s ease;
}

.heartBase {
  fill: #e5162f;
  filter: drop-shadow(0 14px 24px rgba(0,0,0,0.55));
}

.hiddenHeart { opacity: 0; transition: opacity .6s ease; }
.showHeart { opacity: 1; }

.heartOutline {
  fill: transparent;
  stroke: rgba(255,255,255,0.22);
  stroke-width: 6;
  vector-effect: non-scaling-stroke;
  pointer-events: none;
}

.piece {
  fill: #e5162f;
  stroke: none;
  cursor: pointer;

  transform-box: fill-box;
  transform-origin: center;

  transition: transform .45s ease, opacity .35s, fill .25s;
}

.piece:not(.next):not(.locked) { opacity: .35; }

.piece.next {
  fill: #ff224a;
  opacity: 1;
  animation: pulse 1.1s ease-in-out infinite;
  filter: drop-shadow(0 18px 28px rgba(0,0,0,0.55));
}

@keyframes pulse {
  0%   { transform: translate(var(--tx), var(--ty)) rotate(var(--tr)) scale(1); }
  50%  { transform: translate(var(--tx), var(--ty)) rotate(var(--tr)) scale(1.06); }
  100% { transform: translate(var(--tx), var(--ty)) rotate(var(--tr)) scale(1); }
}

.piece.locked { opacity: 1; cursor: default; }

.hint { margin: 12px 0 0; opacity: 0.85; }

.finalImage {
  position: absolute;
  left: 50%;
  top: 50%;
  z-index: 2;

  width: min(480px, 100%);
  max-height: 70vh;
  object-fit: contain;

  opacity: 0;
  transform: translate(-50%, -50%) scale(.9);
  transition: opacity .9s ease, transform .9s ease;
  pointer-events: none;
}

.finalImage.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}

/* –∫–Ω–æ–ø–∫–∞ –º—É–∑—ã–∫–∏ */
.musicBtn {
  position: fixed;
  top: 14px;
  right: 14px;
  z-index: 9999;

  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.18);
  background: rgba(255,255,255,0.10);
  color: #fff;
  cursor: pointer;
  backdrop-filter: blur(6px);
}
.musicBtn:hover { background: rgba(255,255,255,0.14); }

.hidden { display: none; }

/* –º–æ–¥–∞–ª–∫–∞ */
.modal {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  background: rgba(0,0,0,0.55);
  padding: 18px;
  z-index: 5000;
}
.modal.hidden { display: none; }

.modal__card {
  width: min(520px, 92vw);
  border-radius: 18px;
  background: #13131a;
  border: 1px solid rgba(255,255,255,0.12);
  padding: 18px;
  text-align: left;
}
.modal__title { font-size: 18px; font-weight: 800; margin-bottom: 10px; }
.modal__text { opacity: .9; line-height: 1.4; margin-bottom: 12px; }

.modal__input {
  width: 100%;
  padding: 12px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  color: #fff;
  outline: none;
}
.modal__row { display: flex; gap: 10px; margin-top: 12px; }

.btn {
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.10);
  color: #fff;
  cursor: pointer;
}
.btn:hover { background: rgba(255,255,255,0.14); }
.btn--ghost { background: transparent; }

.modal__error { margin-top: 10px; color: #ff6b7a; min-height: 18px; }

/* ‚úÖ –ü–†–û–ñ–ï–ö–¢–û–†–´ ‚Äî –ü–û–î –ö–ê–†–¢–ò–ù–ö–û–ô */
.lightsLayer{
  position: fixed;
  inset: 0;
  z-index: 10;            /* –Ω–∏–∂–µ wrap (20) -> —Å–≤–µ—Ç –∏–∑-–ø–æ–¥ */
  pointer-events: none;
  mix-blend-mode: screen;
  opacity: 0;
  transition: opacity 450ms ease;
}
.lightsLayer.on{ opacity: 0.92; }

.lightBeam{
  position: absolute;
  left: var(--cx, 50vw);
  top:  var(--cy, 50vh);

  width: 190vmax;
  height: 190vmax;

  transform: translate(-50%, -50%) rotate(var(--ang, 0deg));
  transform-origin: 50% 50%;

  /* —É–∑–∫–∏–π –∫–æ–Ω—É—Å, –≤—ã—Ö–æ–¥—è—â–∏–π –∏–∑ —Ü–µ–Ω—Ç—Ä–∞ */
  clip-path: polygon(50% 50%, 42% 100%, 58% 100%);
  filter: blur(16px);
  opacity: 0.6;

  animation: beamSweep var(--dur, 2200ms) ease-in-out infinite;
}

@keyframes beamSweep{
  0%   { opacity: 0.10; transform: translate(-50%, -50%) rotate(calc(var(--ang) - var(--wiggle, 18deg))); }
  20%  { opacity: 0.82; }
  55%  { opacity: 0.38; }
  100% { opacity: 0.12; transform: translate(-50%, -50%) rotate(calc(var(--ang) + var(--wiggle, 18deg))); }
}

/* –º—è–≥–∫–∏–π ‚Äú–æ—Ä–µ–æ–ª‚Äù –≤–æ–∫—Ä—É–≥ stage */
.halo{
  position: absolute;
  left: var(--cx, 50vw);
  top:  var(--cy, 50vh);
  width: 92vmin;
  height: 92vmin;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  background: radial-gradient(circle,
    rgba(255,255,255,0.18) 0%,
    rgba(255,255,255,0.08) 25%,
    rgba(255,255,255,0.00) 60%);
  filter: blur(14px);
  opacity: 0.55;
}

.strobe{
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at center, rgba(255,255,255,0.18), rgba(255,255,255,0));
  opacity: 0;
  animation: strobe 1.05s infinite;
  filter: blur(18px);
}

@keyframes strobe{
  0%, 78%, 100% { opacity: 0; }
  80% { opacity: 0.14; }
  82% { opacity: 0.02; }
  84% { opacity: 0.18; }
  86% { opacity: 0.03; }
  90% { opacity: 0.10; }
}

/* FX layers (–ø–æ–≤–µ—Ä—Ö) */
.fxLayer {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  z-index: 6500;
  pointer-events: none;
}

.catLayer{
  position: fixed;
  inset: 0;
  z-index: 6600;
  pointer-events: none;
}

.fxConfetti {
  transform-box: fill-box;
  transform-origin: center;
  opacity: 0;
  animation: confettiFall var(--dur, 2400ms) linear var(--delay, 0ms) forwards;
}

@keyframes confettiFall {
  0% {
    opacity: 0;
    transform: translate(var(--x, 50vw), -8vh) rotate(var(--r0, 0deg)) scale(var(--s, 1));
  }
  10% { opacity: 1; }
  100% {
    opacity: 0;
    transform: translate(calc(var(--x, 50vw) + var(--drift, 0px)), 110vh)
              rotate(var(--r1, 720deg)) scale(var(--s, 1));
  }
}

.fxBurst {
  opacity: 0;
  transform-origin: center;
  animation: burstPop var(--bdur, 900ms) ease-out var(--bdelay, 0ms) forwards;
}

@keyframes burstPop {
  0%   { opacity: 0; transform: translate(var(--bx, 50vw), var(--by, 50vh)) scale(0.2); }
  20%  { opacity: 1; }
  100% { opacity: 0; transform: translate(var(--bx, 50vw), var(--by, 50vh)) scale(1.35); }
}

.catPop {
  position: absolute;
  font-weight: 800;
  letter-spacing: 0.2px;
  opacity: 0;
  transform: translate(-50%, -50%) scale(0.95);
  filter: drop-shadow(0 10px 18px rgba(0,0,0,0.55));
  animation: catBlink var(--cdur, 900ms) ease-in-out forwards;
  white-space: pre;
}

@keyframes catBlink {
  0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
  20%  { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  70%  { opacity: 1; }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(1.05); }
}

/* fade + video */
.fade {
  position: fixed;
  inset: 0;
  background: #000;
  opacity: 0;
  transition: opacity 900ms ease;
  z-index: 8000;
  pointer-events: none;
}
.fade.show { opacity: 1; }

.cinema {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  z-index: 9000;
}
.cinema.hidden { display: none; }

.cinema__video {
  width: min(900px, 92vw);
  max-height: 80vh;
  border-radius: 16px;
  background: #000;
  box-shadow: 0 30px 80px rgba(0,0,0,0.75);
}

.cinema__hint {
  margin-top: 12px;
  opacity: 0.85;
  font-size: 14px;
}


/* ‚úÖ MUH overlay */
.muhOverlay{
  position: fixed;
  inset: 0;
  z-index: 8500;           /* –≤—ã—à–µ fade(8000), –Ω–∏–∂–µ cinema(9000) */
  display: grid;
  place-items: center;
  pointer-events: none;
  opacity: 0;
  transition: opacity 450ms ease;
}

.muhOverlay.show{
  opacity: 1;
  pointer-events: auto;
}

.muhCard{
  position: relative;
  width: min(620px, 92vw);
  border-radius: 18px;
  overflow: hidden;
  box-shadow: 0 30px 90px rgba(0,0,0,0.75);
  transform: translateY(8px) scale(0.98);
  transition: transform 450ms ease;
}

.muhOverlay.show .muhCard{
  transform: translateY(0) scale(1);
}

.muhImg{
  display: block;
  width: 100%;
  height: auto;
}

.muhBtn{
  position: absolute;
  left: 50%;
  bottom: 14px;
  transform: translateX(-50%);
  backdrop-filter: blur(6px);
}

/* ‚úÖ –¥–µ–ª–∞–µ–º fade ‚Äú–∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ‚Äù, –Ω–µ 100% —á—ë—Ä–Ω—ã–π */
.fade.dim.show{ opacity: 0.78; }



/* =========================================================
   üíñ Post-game Valentine scene
   ========================================================= */
.postBg{
  position: fixed;
  inset: 0;
  background-size: cover;
  background-position: center;
  filter: brightness(.55) saturate(1.05);
}
.postBg::after{
  content:"";
  position:absolute;
  inset:0;
  background: radial-gradient(circle at 50% 40%, rgba(0,0,0,.15), rgba(0,0,0,.55));
}

.boom{
  position: fixed;
  left: 50%;
  top: 50%;
  width: 12vmax;
  height: 12vmax;
  transform: translate(-50%,-50%) scale(0.05);
  border-radius: 50%;
  background: radial-gradient(circle,
    rgba(255,255,255,0.95) 0%,
    rgba(255,190,220,0.90) 18%,
    rgba(120,220,255,0.55) 38%,
    rgba(255,255,255,0.00) 70%);
  animation: boomPulse 1100ms ease-out forwards;
  pointer-events: none;
  mix-blend-mode: screen;
}
.boom::after{
  content:"";
  position:absolute;
  inset:-20%;
  border-radius:50%;
  background: radial-gradient(circle,
    rgba(255,255,255,0.0) 0%,
    rgba(255,255,255,0.0) 45%,
    rgba(255,220,240,0.65) 55%,
    rgba(255,255,255,0.0) 72%);
  animation: boomRing 1100ms ease-out forwards;
}
@keyframes boomPulse{
  0%{ transform: translate(-50%,-50%) scale(0.05); opacity: 0.0; }
  10%{ opacity: 1; }
  100%{ transform: translate(-50%,-50%) scale(5.6); opacity: 0; }
}
@keyframes boomRing{
  0%{ transform: scale(0.25); opacity: 0.0; }
  15%{ opacity: 1; }
  100%{ transform: scale(1.7); opacity: 0; }
}

.postCard{
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%,-50%);
  width: min(92vw, 760px);
  text-align: center;
  display: grid;
  gap: 18px;
  padding: 22px 18px;
  z-index: 5;
}
.postTitle{
  font-weight: 900;
  letter-spacing: .5px;
  font-size: clamp(28px, 4.2vw, 56px);
  text-shadow: 0 10px 30px rgba(0,0,0,.55);
}
.postGif{
  width: min(72vw, 520px);
  height: auto;
  margin: 0 auto;
  filter: drop-shadow(0 16px 40px rgba(0,0,0,.55));
}
.postYes{
  width: min(78vw, 420px);
  margin: 0 auto;
  border: 0;
  border-radius: 18px;
  padding: 16px 18px;
  font-weight: 900;
  font-size: clamp(22px, 3.2vw, 32px);
  cursor: pointer;
  color: #6b163a;
  background: linear-gradient(180deg, #ffd3e7, #ffb7d6);
  box-shadow: 0 14px 40px rgba(0,0,0,.35);
  transition: transform .12s ease, filter .12s ease;
}
.postYes:hover{ transform: translateY(-2px); filter: brightness(1.02); }
.postYes:active{ transform: translateY(0px); filter: brightness(.98); }
.postYes:disabled{ opacity: .75; cursor: default; }

.endFade{
  position: fixed;
  inset: 0;
  background: #000;
  opacity: 0;
  transition: opacity 3.2s ease;
  z-index: 10;
  pointer-events: none;
}
.endFade.show{ opacity: 1; }



/* =========================================================
   Intro overlay (post-Continue sequence) ‚Äî BIGGER + blinking arrows
   ========================================================= */
.introOverlay{
  position: fixed;
  inset: 0;
  z-index: 13000;
  display: grid;
  place-items: center;
  pointer-events: none;
}
.introOverlay.hidden{ display:none; }

.introWrap{
  position: relative;
  width: min(1280px, 94vw);
  height: min(760px, 80vh);
  display: grid;
  grid-template-rows: auto 1fr;
  gap: 18px;
  align-items: center;
  justify-items: center;
}

.introTitle{
  font-size: clamp(46px, 6.5vw, 96px);
  font-weight: 900;
  letter-spacing: 0.6px;
  color: #fff;
  text-shadow: 0 12px 44px rgba(0,0,0,.75);
  text-align: center;
}

.introGif{
  width: min(760px, 86vw);
  max-height: 66vh;
  object-fit: contain;
  border-radius: 18px;
  background: rgba(0,0,0,0.18);
  box-shadow: 0 18px 70px rgba(0,0,0,.55);
}

.introArrow{
  position: absolute;
  font-size: clamp(64px, 8vw, 132px);
  font-weight: 900;
  color: #fff;
  text-shadow: 0 12px 36px rgba(0,0,0,.75);
  animation: blinkArrow .70s steps(1,end) infinite;
  transform-origin: center;
}
.introArrow.left{ left: 4.5%; top: 54%; --rot: -20deg; }
.introArrow.right{ right: 4.5%; top: 54%; --rot: 200deg; }

@keyframes blinkArrow{
  0%,45%{ opacity: 1; transform: translateY(0) rotate(var(--rot, 0deg)) scale(1); }
  55%,100%{ opacity: 0.18; transform: translateY(-10px) rotate(var(--rot, 0deg)) scale(1.06); }
}
